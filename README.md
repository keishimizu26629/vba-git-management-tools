# VBA Code Management Tools


Excel VBAプロジェクトのソースコード管理ツール群です。VBAモジュールをエクスポート/インポートする機能を提供し、バージョン管理システム（Git等）との統合を容易にします。


## 機能


- VBAモジュールのエクスポート（ExportVBA.vbs）
  - Excel ブック内の全VBAモジュールを個別のソースファイルとして出力
  - モジュールタイプ（標準モジュール、クラスモジュール、フォーム）に応じた適切な拡張子での保存
  - プロジェクトごとのフォルダ分け


- VBAモジュールのインポート（ImportVBA.vbs）
  - ソースファイルからVBAモジュールを再構築
  - 既存モジュールの安全な置き換え
  - プロジェクト単位での一括インポート


## フォルダ構造


```
Project/
├── src/           # ソースコードフォルダ
│   ├── Book1/     # Book1.xlsmのVBAソース
│   │   ├── *.bas  # 標準モジュール
│   │   ├── *.cls  # クラスモジュール
│   │   └── *.frm  # フォーム
│   └── Book2/     # Book2.xlsmのVBAソース
│       ├── *.bas
│       ├── *.cls
│       └── *.frm
├── bin/           # Excelファイル配置フォルダ
│   ├── Book1.xlsm
│   └── Book2.xlsm
├── tools/         # ツール配置フォルダ
│   ├── ExportVBA.vbs
│   └── ImportVBA.vbs
└── .gitignore     # Git設定ファイル
```


## セットアップ


1. このリポジトリをクローンまたはダウンロード
2. 上記のフォルダ構造を作成
3. `bin` フォルダにVBAプロジェクトを含むExcelファイル（.xlsm）を配置


### 必要な設定


1. Excelのセキュリティ設定
   - Excel を開く
   - ファイル > オプション > セキュリティセンター > セキュリティセンターの設定
   - マクロの設定
   - 「VBAプロジェクトオブジェクトモデルへのアクセスを信頼する」をチェック


2. スクリプトの文字コード
   - ExportVBA.vbs、ImportVBA.vbs は必ずShift-JISで保存


## 使用方法


### エクスポート


1. `bin` フォルダに対象のExcelファイル（.xlsm）を配置
2. ExportVBA.vbs を実行
   ```cmd
   cscript tools\ExportVBA.vbs
   ```
3. `src` フォルダ内に各Excelファイルに対応するフォルダが作成され、その中にVBAモジュールが出力されます


### インポート


1. `src` フォルダ内の対象プロジェクトフォルダにVBAソースファイルが配置されていることを確認
2. ImportVBA.vbs を実行
   ```cmd
   cscript tools\ImportVBA.vbs
   ```
3. `bin` フォルダ内の対応するExcelファイルにVBAモジュールがインポートされます


## エラー対応


### よくあるエラー


1. VBAプロジェクトにアクセスできない
   - Excelのセキュリティ設定を確認
   - VBAプロジェクトオブジェクトモデルへのアクセスを許可


2. ファイルを開けない
   - 対象のExcelファイルが他のプロセスで開かれていないか確認
   - ファイルの読み書き権限を確認


3. モジュールのエクスポート/インポートに失敗
   - VBAプロジェクトのパスワード保護を確認
   - ファイルシステムの権限を確認


### トラブルシューティング


1. ログメッセージを確認
   - 実行時に表示されるメッセージで問題を特定
   - エラー番号とメッセージを確認


2. フォルダ構造の確認
   - 必要なフォルダが存在するか確認
   - パスが正しく設定されているか確認


3. ファイルの状態確認
   - Excelファイルが破損していないか確認
   - 適切な権限があるか確認


## .gitignore 設定例


```gitignore
# Excel temporary files
~$*.xls*


# Excel backups
*.xlk


# Compiled VBA files
*.exe
*.dll


# Binary folder (Excel files)
/bin/*
!/bin/.gitkeep


# Keep source files
!/src/**/*.bas
!/src/**/*.cls
!/src/**/*.frm
```


## 注意事項


- エクスポート/インポート前に対象のExcelファイルを必ず閉じてください
- VBAプロジェクトにパスワード保護がある場合は、保護を解除してから実行してください
- 大量のモジュールを含むプロジェクトの場合、処理に時間がかかる場合があります
- バイナリファイル（.xlsm）は原則としてバージョン管理対象外とし、ソースコードのみを管理することを推奨します


## ライセンス


このツールは自由に使用、改変、再配布が可能です。ただし、使用に際して発生する問題については責任を負いかねます。
